;;; Test MUL and DMUL

.import ../src/ladybug

.postfix PSEI, DSZI, DECI, INCI, WSIZE, LDI, STI, CMP  (semi-merged-postfix)
.postfix MASKL, MASKR, BITSUM, TST, SL, SR  (semi-merged-postfix)
.postfix #LIT (semi-merged-integer-literal)

LBL "TMUL"
WSIZE 64
MASKL 4   ; F000..
ENTERI
SR 01     ; (F000... >> 1)
SF 02     ; signed mode
DMUL      ; should give  X = F8800....  and Y= 0
TST Y     ; Y= lower part, should be 0
FC? 00
SF 99
#LIT 0xf88
SL 52
SUB
FC? 00
SF 99

CF 02  ; unsigned, multiply 2 by 1,2,4...
#LIT 1
STI 00    ; 1,2,4,8,...
STI 01    ; 1,2,3,...

LBL 01
LDI 00
#LIT 2
MUL
#LIT 1
SL IND 01
SUB
FC? 00
SF 99
LDI 00
SL 01
FS? 03   ; got carry?
GTO 09   ; yes
STI 00
INCI 01
GTO 01

LBL 09

MASKL 7
ENTERI
DMUL
FS? 00
SF 99
#LIT 0xfc04
SL 48
SUB
FC? 00
SF 99
ADD
FS? 03
SF 99
FC? 00
SF 99
END
